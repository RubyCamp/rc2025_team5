<%# 温泉検索フォーム用パーシャル %>
<%# 複合検索機能を提供：テキスト検索 + タグ検索 + 位置情報検索 %>
<div class="mb-6" role="search" aria-label="温泉検索">
  <%= form_with url: onsens_path, method: :get, local: true,
                class: "space-y-4 p-4 border rounded-lg bg-gray-50",
                'aria-label': "温泉検索フォーム" do |f| %>
    <%# テキスト・タグ検索セクション %>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <%# 温泉名・説明文での検索 %>
      <div>
        <%= f.label :q, t('activerecord.attributes.onsen.name'),
                     class: "block text-sm font-bold mb-1" %>
        <%= f.text_field :q, value: params[:q],
                          class: "w-full border rounded px-3 py-2",
                          placeholder: "例：玉造温泉",
                          'aria-label': t('views.onsens.index.search') %>
        <p class="text-xs text-gray-600 mt-1">温泉名や説明文で検索できます</p>
      </div>
      <%# タグでの絞り込み検索 %>
      <div>
        <%= f.label :tags, t('activerecord.attributes.onsen.tags'),
         class: "block text-sm font-bold mb-1" %>
        <%= f.text_field :tags, value: params[:tags],
                          class: "w-full border rounded px-3 py-2",
                          placeholder: "例：露天風呂,美肌",
                          'aria-label': t('activerecord.attributes.onsen.tags') %>
        <p class="text-xs text-gray-600 mt-1">カンマ区切りで複数指定可能</p>
      </div>
    </div>
    <%# 位置情報検索セクション %>
    <%= render 'location_search_form', f: f %>
    <%# 営業時間検索セクション %>
    <%= render 'open_hour_search_form', f: f %>
    <%#ジャンルの検索セクション%>
    <%= render 'genre_search_form', f: f %>
    <%# 検索実行ボタン %>
    <div class="text-center pt-2">
      <%= f.submit t('views.onsens.index.search'),
                   class: "bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",
                   'aria-label': t('views.onsens.index.search') %>
    </div>
  <% end %>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const button = document.getElementById("now-time-button");
      const input = document.getElementById("open-time-input");

      button.addEventListener("click", function () {
        const now = new Date();
        const hh = String(now.getHours()).padStart(2, "0");
        const mm = String(now.getMinutes()).padStart(2, "0");
        input.value = hh + mm;
      });
    });
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("open-time-form");
    const input = document.getElementById("open-time-input");
    const errorMessage = document.getElementById("time-error-message");
    form.addEventListener("submit", function (event) {
    const value = input.value.trim();
    if (!/^\d{4}$/.test(value)) {
    showError("4桁の半角数字で入力してください（例：1700）");
    event.preventDefault();
    return;
    }
    const num = parseInt(value, 10);
    const minutes = num % 100;
    const hours = Math.floor(num / 100);
    if (hours > 23 || minutes > 59) {
    showError("0000〜2359 の間で、分は 00〜59 で入力してください");
    event.preventDefault();
    return;
    }
    hideError();
    });
    function showError(msg) {
    errorMessage.textContent = msg;
    errorMessage.classList.remove("hidden");
    }
    function hideError() {
    errorMessage.textContent = "";
    errorMessage.classList.add("hidden");
    }
    });
  </script>
</div>